name: Update main.json via GitHub Issue

description: |
  ç•¶æœ‰äººç™¼å‡ºåŒ…å«ç‰¹å®šæ ¼å¼çš„ GitHub Issueï¼Œå°‡è§£æå•†å“è³‡è¨Šä¸¦è‡ªå‹•æ›´æ–° main.json

on:
  issues:
    types: [opened]

jobs:
  update-from-issue:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.title, 'æ–°å¢å•†å“')

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: è§£æå•†å“è³‡æ–™ from Issue Body
        id: parse
        run: |
          echo "ğŸ“¥ Issue Body:"
          echo "${{ github.event.issue.body }}"

          echo "::set-output name=barcode::$(echo '${{ github.event.issue.body }}' | grep 'barcode:' | sed 's/.*barcode: *//')"
          echo "::set-output name=name::$(echo '${{ github.event.issue.body }}' | grep 'name:' | sed 's/.*name: *//')"
          echo "::set-output name=price::$(echo '${{ github.event.issue.body }}' | grep 'price:' | sed 's/.*price: *//')"
          echo "::set-output name=image::$(echo '${{ github.event.issue.body }}' | grep 'image:' | sed 's/.*image: *//')"
          echo "::set-output name=description::$(echo '${{ github.event.issue.body }}' | grep 'description:' | sed 's/.*description: *//')"
          echo "::set-output name=specialOffers::$(echo '${{ github.event.issue.body }}' | grep 'specialOffers:' | sed 's/.*specialOffers: *//')"

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Run update script
        run: |
          node update-json.js "${{ steps.parse.outputs.barcode }}" \
                              "${{ steps.parse.outputs.name }}" \
                              "${{ steps.parse.outputs.price }}" \
                              "${{ steps.parse.outputs.image }}" \
                              "${{ steps.parse.outputs.description }}" \
                              "${{ steps.parse.outputs.specialOffers }}"

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add main.json
          git commit -m "ğŸ“¦ é€é issue æ›´æ–°å•†å“ï¼š${{ steps.parse.outputs.barcode }}"
          git push
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
